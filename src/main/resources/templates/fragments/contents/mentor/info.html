<!DOCTYPE html>
<html lang="ko"
      layout:decorate="~{layout/default}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
>
<head>
  <title>Anchor-service</title>
  <script src="/js/jquery-3.7.1.min.js"></script>
</head>

<div layout:fragment="content" class="main">
  <h2 style="text-align: center;">ë©˜í†  ì •ë³´ í˜ì´ì§€</h2>

  <div class="container mt-3" style="max-width: 1480px;">
  <hr>
    <div class="row">
      <!-- [ì¢Œì¸¡] ë©˜í†  ì •ë³´ ì‹œì‘ -->
      <div class="col-md-3 text-center">
        <!--ë°©ë¬¸ì, ë©˜í‹°, ë‹¤ë¥¸ ë©˜í†  í˜ì´ì§€-->
        <div class="card">
          <div class="card-header">ë©˜í†  ì •ë³´</div>
          <div id="current-profile-image" class="mt-3">
            <div class="profile">
              <th:block th:if="${mentorInfo.user.image==null}">
                <img src="/images/x.png"
                     id="userProfileImage" width="200px">
              </th:block>
              <th:block th:unless="${mentorInfo.user.image==null}">
                <img th:src="${mentorInfo.user.image}" id="userProfileImage" width="200px">
              </th:block>
            </div>
          </div>
          <div class="card-body">
            <hr>
            <!--ë‹‰ë„¤ì„-->
            <div class="form-group row justify-content-center">
              <label for="nickname" class="col-sm-4 col-form-label text-end" style="color: #808080;">ë‹‰ë„¤ì„</label>
              <div class="col-sm-8">
                <span class="form-control-plaintext text-start" id="nickname" name="nickname" th:text="${mentorInfo.user.nickname}"></span>
              </div>
            </div>
            <!--íšŒì‚¬ ê³„ì •-->
            <div class="form-group row justify-content-center">
              <label for="companyEmail" class="col-sm-4 col-form-label text-end" style="color: #808080;">íšŒì‚¬ ê³„ì •</label>
              <div class="col-sm-8">
                <span class="form-control-plaintext text-start" id="companyEmail" name="companyEmail"  th:text="${mentorInfo.companyEmail}"></span>
              </div>
            </div>
            <!--ì»¤ë¦¬ì–´-->
            <div class="form-group row justify-content-center">
              <label for="current-career" class="col-sm-4 col-form-label text-end" style="color: #808080;">ì—°ì°¨</label>
              <div class="col-sm-8">
                <span class="form-control-plaintext text-start" id="current-career" name="current-career" th:text="${mentorInfo.career} +' (' + ${mentorInfo.career.rangeOfYear} +')'"></span>
              </div>
            </div>
          </div>
        </div>

        <!--ë©˜í†  + ìì‹ ì˜ í˜ì´ì§€-->
        <th:block th:if="${mentorInfo.user.id == #authentication.principal.user.id}"> <!--#authentication.principal.user.id-->
          <div class="card mt-3">
            <div class="card-header">ë©˜í†  í•„ìˆ˜ì •ë³´</div>
            <div class="card-body">
              <!--ì»¤ë¦¬ì–´-->
              <div class="form-group row justify-content-center">
                <label for="career" class="col-sm-4 col-form-label text-end" style="color: #808080;">ì—°ì°¨</label>
                <div class="col-sm-8">
                  <select class="form-control" id="career" name="career" >
                    <option value=''>-ì„ íƒ-</option>
                    <option th:each="career : ${T(com.anchor.domain.mentor.domain.Career).values()}"
                            th:value="${career.name()}"
                            th:text="${career.name()} +' (' + ${career.rangeOfYear} + ')'">
                      Select Career
                    </option>
                  </select>
                </div>
              </div>

              <!--ì€í–‰ëª…-->
              <div class="form-group row justify-content-center">
                <label for="bankName" class="col-sm-4 col-form-label text-end" style="color: #808080;">ì€í–‰ëª…</label>
                <div class="col-sm-8">
                  <select class="form-control" id="bankName" name="bankName" >
                    <option value=''>-ì„ íƒ-</option>
                    <option value='SCì œì¼ì€í–‰'>SCì œì¼ì€í–‰</option>
                    <option value='ê²½ë‚¨ì€í–‰'>ê²½ë‚¨ì€í–‰</option>
                    <option value='ê´‘ì£¼ì€í–‰'>ê´‘ì£¼ì€í–‰</option>
                    <option value='êµ­ë¯¼ì€í–‰'>êµ­ë¯¼ì€í–‰</option>
                    <option value='ê¸°ì—…ì€í–‰'>ê¸°ì—…ì€í–‰</option>
                    <option value='ë†í˜‘ì¤‘ì•™íšŒ'>ë†í˜‘ì¤‘ì•™íšŒ</option>
                    <option value='ëŒ€êµ¬ì€í–‰'>ëŒ€êµ¬ì€í–‰</option>
                    <option value='ë¶€ì‚°ì€í–‰'>ë¶€ì‚°ì€í–‰</option>
                    <option value='ì‚°ì—…ì€í–‰'>ì‚°ì—…ì€í–‰</option>
                    <option value='ìƒí˜¸ì‹ ìš©ê¸ˆê³ '>ìƒí˜¸ì‹ ìš©ê¸ˆê³ </option>
                    <option value='ìƒˆë§ˆì„ê¸ˆê³ '>ìƒˆë§ˆì„ê¸ˆê³ </option>
                    <option value='ìˆ˜í˜‘ì¤‘ì•™íšŒ'>ìˆ˜í˜‘ì¤‘ì•™íšŒ</option>
                    <option value='ì‹ í•œì€í–‰'>ì‹ í•œì€í–‰</option>
                    <option value='ì‹ í˜‘ì¤‘ì•™íšŒ'>ì‹ í˜‘ì¤‘ì•™íšŒ</option>
                    <option value='ì™¸í™˜ì€í–‰'>ì™¸í™˜ì€í–‰</option>
                    <option value='ìš°ë¦¬ì€í–‰'>ìš°ë¦¬ì€í–‰</option>
                    <option value='ìš°ì²´êµ­'>ìš°ì²´êµ­</option>
                    <option value='ì „ë¶ì€í–‰'>ì „ë¶ì€í–‰</option>
                    <option value='ì œì£¼ì€í–‰'>ì œì£¼ì€í–‰</option>
                    <option value='í•˜ë‚˜ì€í–‰'>í•˜ë‚˜ì€í–‰</option>
                    <option value='í•œêµ­ì”¨í‹°ì€í–‰'>í•œêµ­ì”¨í‹°ì€í–‰</option>
                    <option value='í™ì½©ìƒí•˜ì´ì€í–‰'>í™ì½©ìƒí•˜ì´ì€í–‰</option>
                  </select>
                </div>
              </div>

              <!--ê³„ì¢Œ ë²ˆí˜¸-->
              <div class="form-group row justify-content-center">
                <label for="accountNumber" class="col-sm-4 col-form-label text-end" style="color: #808080;">ê³„ì¢Œ ë²ˆí˜¸</label>
                <div class="col-sm-8">
                  <input type="text" class="form-control" id="accountNumber" name="accountNumber" th:value="${mentorInfo.accountNumber}">
                </div>
              </div>

              <!--ê³„ì¢Œ ì†Œìœ ì£¼ ì´ë¦„-->
              <div class="form-group row justify-content-center">
                <label for="accountName" class="col-sm-4 col-form-label text-end" style="color: #808080;">ê³„ì¢Œ ì†Œìœ ì£¼</label>
                <div class="col-sm-8">
                  <input type="text" class="form-control" id="accountName" name="accountName" th:value="${mentorInfo.accountName}">
                </div>
              </div>
              <div>
                <button type="button" class="btn btn-outline-success mt-3" id="btn-mentor-update">ìˆ˜ì •í•˜ê¸°</button>
                <button type="button" class="btn btn-outline-danger mt-3" id="btn-mentor-delete">ë©˜í†  ê¶Œí•œ í•´ì œí•˜ê¸°</button>
              </div>
            </div>
          </div>
        </th:block>
      </div>
      <!-- [ì¢Œì¸¡] ë©˜í†  ì •ë³´ ë -->



      <!-- [ìš°ì¸¡] ë©˜í†  ì†Œê°œê¸€ ë° ë©˜í† ë§ ëª©ë¡  ì‹œì‘-->
      <div class="col-md-9">
        <form>
          <!--ë©˜í†  ì†Œê°œê¸€-->
          <div class="form-group">
            <label for="mentorContents" style="font-size: 20px; text-align: center; font-weight: bold;">ë©˜í†  ì†Œê°œê¸€</label>
            <textarea class="form-control mt-2" id="mentorContents" rows="5" placeholder="ìƒì„¸ ë‚´ìš© ì…ë ¥" readonly
                      th:text="${mentorInfo.mentorIntroduction != null ? mentorInfo.mentorIntroduction.contents : 'ì•ˆë…•í•˜ì„¸ìš”ğŸ–ğŸ» ë©˜í† ë§ì„ ì‹ ì²­í•´ë³´ì„¸ìš”^^'}">
            </textarea>

            <th:block th:if="${mentorInfo.user.id == #authentication.principal.user.id}"> <!--#authentication.principal.user.id-->
              <a th:href="@{/mentors/me/introduction}" class="btn btn-success mt-3">ë©˜í†  ì†Œê°œê¸€ ìˆ˜ì •</a>
            </th:block>
          </div>

          <!--ë©˜í† ë§ ëª©ë¡-->
          <div class="form-group mt-4">
            <label for="mentoringList" style="font-size: 20px; text-align: center; font-weight: bold;">ë©˜í† ë§ ëª©ë¡</label>
            <div class="row" id="mentoringList">
              <div th:each="mentorings, iterStat : ${mentorInfo.mentorings}" class="col-md-4 mb-4">
                <div class="card mt-2">
                  <div class="card-body">
                    <h5 class="card-title" th:text="${mentorings.title}">ë©˜í† ë§ ì£¼ì œ</h5>

                    <div class="form-group row" >
                      <label for="durationTime" class="col-sm-3 col-form-label" style="color: #808080;">ì‹œê°„</label>
                      <div class="col-sm-9">
                        <span class="form-control-plaintext text-start" id="durationTime" name="durationTime" th:text="${mentorings.durationTime}">1ì‹œê°„</span>
                      </div>
                    </div>
                    <div class="form-group row" >
                      <label for="cost" class="col-sm-3 col-form-label" style="color: #808080;">ë¹„ìš©</label>
                      <div class="col-sm-9">
                        <span class="form-control-plaintext text-start" id="cost" name="cost" th:text="${mentorings.cost} + 'ì›'">1ë§Œì›</span>
                      </div>
                    </div>
                    <a th:href="@{/mentorings/{id}(id=${mentorings.id})}" class="btn btn-primary mt-3">ìƒì„¸ ë³´ê¸°</a>
                    <th:block th:if="${mentorInfo.user.id == #authentication.principal.user.id}"> <!--#authentication.principal.user.id-->
                      <button type="button" class="btn btn-danger mt-3" id="btn-mentoring-delete">ë©˜í† ë§ ì‚­ì œ</button>
                    </th:block>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <!-- [ìš°ì¸¡] ë©˜í†  ì†Œê°œê¸€ ë° ë©˜í† ë§ ëª©ë¡  ë-->
    </div>
  </div>

  <script th:inline="javascript">
    let mentor_id = [[${mentorInfo.id}]];

    let index = {
      init: function () {
        $("#btn-mentor-update").on("click", () => {
          this.updateMentor();
        });
        $("#btn-mentor-delete").on("click", () => {
          this.deleteMentor();
        });
        $("#btn-mentoring-delete").on("click", () => {
          this.deleteMentoring();
        });
      },

      /*ì •ë³´ ìˆ˜ì •*/
      updateMentor: function(){
        let data = {
          career:$("#career").val(),
          bankName:$("#bankName").val(),
          accountNumber:$("#accountNumber").val(),
          accountName:$("#accountName").val()
        };
        $.ajax({
          type: "put",
          url: "/mentors/me/info",
          data: JSON.stringify(data),
          contentType: "application/json; charset=utf-8",
        }).done(function (resp) {
          if(resp.status===500){
            alert("ë©˜í†  í•„ìˆ˜ ì •ë³´ ìˆ˜ì •ì„ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          } else {
            alert("ë©˜í†  í•„ìˆ˜ ì •ë³´ ìˆ˜ì •ì„ ì„±ê³µí–ˆìŠµë‹ˆë‹¤.");
            location.href="/mentors/" + mentor_id;
          }
        }).fail(function (error) {
          alert(JSON.stringify(error));
        });
      },
      /*ë©˜í†  ê¶Œí•œ í•´ì œ*/
      deleteMentor: function(){
        let data = {
          mentorId : [[${mentorInfo.id}]]
        };
        $.ajax({
          type: "delete",
          url: "/mentors/me",
          data: JSON.stringify(data),
          contentType: "application/json; charset=utf-8",
        }).done(function (resp) {
          if(resp.status===500){
            alert("ë©˜í†  ê¶Œí•œ í•´ì œ ì‹¤íŒ¨");
            location.href="/mentors/" + mentor_id;
          } else {
            alert("ë©˜í†  ê¶Œí•œ í•´ì œ ì„±ê³µ");
            location.href="/";
          }
        }).fail(function (error) {
          alert("ë©˜í† ë§ ëª©ë¡ì„ ëª¨ë‘ ì‚­ì œ í›„ ë©˜í†  ê¶Œí•œ í•´ì œê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
          location.href="/mentors/" + mentor_id;
        });
      },
      /*ë©˜í† ë§ ì‚­ì œ*/
      deleteMentoring: function(){
        console.log("click");
      },
    }

    index.init();
  </script>
</div>

</html>